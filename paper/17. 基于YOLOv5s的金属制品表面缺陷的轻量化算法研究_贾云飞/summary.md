## YOLOv5s的金属制品表面缺陷的轻量化算法
- 目的:为了解决企业降低智能化成本的需求，运用低成本、低算力的硬件设备，通过深度学习中目标检测算法模型对产品进行缺陷检测。
- YOLOv5s是一种基于深度学习的one-stage目标检测算法，相比于two-stage算法，它可以直接输出目标的类别和位置信息，具有更高的速度和效率。但是，YOLOv5s模型仍然有一定的计算量和参数量，可能不适合在低成本和低算力的硬件设备上运行。因此，论文采用了结构裁剪的方法，对YOLOv5s模型进行了优化和压缩。
### 方法
#### 结构裁剪
- 采用结构裁剪的思想，基于网络中的BN层对网络进行稀疏训练，然后将稀疏训练后的模型对应权重值较小的层进行裁剪，从而降低模型的计算参数数量以及模型文件大小。
- 结构裁剪的思想是通过删除网络中不重要或冗余的部分，来减少模型的复杂度和大小。论文主要对网络中的BN层（batch normalization层）进行裁剪，因为BN层可以对网络输入进行归一化处理，提高网络学习效率，但也会增加网络参数。
- 论文首先对YOLOv5s模型添加了L1正则化约束，使得网络稀疏化，即让BN层中的γ参数（缩放参数）分布接近于0。然后，对γ参数值较小的BN层进行裁剪，同时裁剪相邻上层的卷积核和向下层输出的通道。这样可以降低模型的计算参数数量和模型文件大小，达到轻量化的效果。
- ![](https://github.com/OctoberEnd/verbose-invention/blob/main/pic/%E8%A3%81%E5%89%AA.jpg?raw=true)
#### 基于 TensorRT 的推理加速
- TensorRT可以对神经网络进行一系列转换和优化，例如删除未使用的网络层、对多个层进行融合、移除连接层等。这样可以减少函数调用次数和内存传输次数，提高推理速度。
- 将backbone的Focus替换为一个3x3Conv，将backbone所有Conv和C3替换为Shuffle Block，砍掉SPP和后面的一个C3结构，将head所有层输入输出channel=96，将head所有C3改为DWConv，将PAN的两个Concat改为ADD。
- 使用NVIDIA的加速推理框架TensorRT对训练好的裁剪模型进行层级融合，实现推理加速效果。
### 结果对比 
- 这篇论文的结果是所提目标检测模型相对于原始YOLOv5s模型权重文件大小降低约70%，同时在公开数据集NEU-DET上检测精度达到了74.2%。在搭建的高性能实验台中单图推理速度相比原模型提升了11.3%，且网络没有精度损失;在低性能实验台中，所提模型相比原网络模型推理速度提升了165%，相比高性能实验台中的结果有了更显著的提升，说明所提模型在低算力硬件设备中表现优秀。再针对所提模型采用公开的潜水泵叶轮的俯视图数据集进行普适性测试，最后对所提模型采用推理加速框架TensorRT进行加速后，在高性能实验台上可以达到单图5.8 ms 的推理时间。
### 实验流程

![](https://github.com/OctoberEnd/verbose-invention/blob/main/pic/%E6%B5%81%E7%A8%8B.jpg?raw=true)
### sum
这篇论文的结论是本文从企业需要更低的硬件成本的角度出发，通过深度学习网络模型中结构裁剪的思想，提出一种基于YOLOv5s轻量化改进的网络并结合TensorRT加速推理框架。该方法很好地实现了模型权重文件大小缩减，降低运算量，且保证精度没有损失，可以满足产品缺陷实时检测的需求。
