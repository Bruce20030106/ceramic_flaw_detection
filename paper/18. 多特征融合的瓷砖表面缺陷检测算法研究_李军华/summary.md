- 问题：在瓷砖种类较多的情况下，单一特征对瓷砖表面缺陷内容表达不明显，导致复杂瓷砖识别率较低。
- 解决方案：在**词袋模型（BoF）框架**的基础上，提出一种有效的**多特征融合算法**用于瓷砖缺陷检测。
- 算法实现：该算法采用**改进后的SIFT和颜色矩融合特征**作为瓷砖图像的区域特征描述。根据每种特征对瓷砖被分类的准确率大小，给提取到的两种区域特征分配各自的权重系数实现特征的加权融合。


# 1、引言
	已有的分类算法大多采用瓷砖图像的颜色特征或是其简单的边缘信息进行分类，Hanzaei等人[1]通过对瓷砖表面缺陷区域进行标记，提取缺陷的几何特征来实现缺陷瓷砖的分类。Ragab 等人[2]提出基于图像处理单元的并行算法，对瓷砖选区域进行分类，大大缩短了其检测所需要的时间。李庆利等人[3]提出一种基于灰色关联分析的颜色特征提取算法，完成了陶瓷砖表面缺陷的检测。

**以上算法虽然能对缺陷瓷砖进行较好的检测和分类，但大多只对含有简单花纹的瓷砖和单色瓷砖有效，而对于花纹复杂的瓷砖由于其表面干扰较大，出错率较高，很难满足实际生产线上的需求。因此，需要研究一种针对复杂瓷砖表面缺陷的分类方法。**

采用传统算法提取瓷砖表面缺陷特征进行分类时，由于**缺陷本身的异构性和不明确性，使得提取到的缺陷特征过于单薄，特征量过小而无法满足预期的效果**，因此提出一种基于多特征融合的瓷砖表面缺陷检测算法。

该算法对瓷砖图像特征的提取主要分为两部分

1. 在 BoF 模型的基础上，采用 SIFT 算法改进之后的 FSIFT 算法来描述灰度瓷砖缺陷图像的区域特征，该算法结合了 SIFT 特征的优点，同时弥补了 SIFT 算法无法满足实时性要求的不足，加快了运算速度； 
2. 采用颜色矩来描述彩色瓷砖缺陷图像的区域特征。对于上述步骤所提取到的两种瓷砖图像缺陷区域的特征首先采用预分类处理，根据每种特征对瓷砖被分类的准确率大小分配 0和1作为各自的权重系数实现特征的加权融合，并将融合后的综合特征向量送入 SVM 分类器中进行最终分类，从而完成瓷砖缺陷图像的分类任务。
 
本文提出的基于多特征融合的瓷砖表面缺陷检测算法，**耗时较短、过程简单且能获得大量的特征，具有更强的容错能力**，相对于传统的多特征融合分类方法[5-6]，进一步提升了瓷砖分类的准确率。

# 2、相关工作
## 流程
1. 将彩色瓷砖图像转换为灰度图像，使用 FSIFT 算法对特征点进行描述。
2. 使用 BoF 模型对得到的缺陷特征向量进行量化编码以解决瓷砖图像特征数量不一的问题。
3. 将颜色空间转换至 HSV 空间并使用颜色矩特征提取彩色瓷砖图像的特征。
4. 将提取到的两种不同的特征向量进行加权融合形成综合特征向量，输入到训练好的分类器中。

## [SIFT算法（知乎）](https://zhuanlan.zhihu.com/p/343522892)

1. [SIFT四部曲之——极值检测和定位)](https://blog.csdn.net/hit2015spring/article/details/52972890)
2. [SIFT四部曲之——高斯滤波](https://blog.csdn.net/hit2015spring/article/details/52895367?spm=1001.2014.3001.5502)

[SIFT(尺度不变特征变换)（2倍速观看）](https://www.bilibili.com/video/BV1Qb411W7cK/?spm_id_from=333.337.search-card.all.click&vd_source=76039304b78bf351fa45d5750955e749)
SIFT算法的实质是在不同的尺度空间上查找关键点，并计算出关键点的方向。所查找到的关键点是一些十分突出，不会因光照，仿射变换和噪音等因素而变化的点，如角点、边缘点、暗区的亮点及亮区的暗点等。平滑的区域或点肯定变化不大，而纹理复杂的比如边缘，点，角之类区域肯定变化很大，这样变化很大的点就是**特征点**。

1.隔点去点、卷积建立高斯金字塔（模拟近大远小，高斯核（唯一）卷积模拟近处清晰远处模糊）。高斯金字塔同组相邻两层相减得到高斯差分金字塔。O（组）、S（层）。5张图片只能得到2张图片的特征（上下图片不能求导）。

![](https://github.com/dhf97/image/raw/main/CFJZT.jpg)

定σ。第一组第一层是σ0（摄像机自带模糊尺度0.5，希望第一次卷积之后尺度达到1.6，因此高斯核等于1.52）。第二组把第一组的倒数第三层下采样得到第一层。

![](https://github.com/dhf97/image/raw/main/SIGMA.jpg)

2.**（非常难）**关键点（稳定，不会变化，包含很多信息的点（极值点））位置确定。阈值化，小于此值可能是噪声，不保留。找到真正的极值点，舍去对比度低的点，去除边缘效应（曲率异号）。

![](https://github.com/dhf97/image/raw/main/KP.jpg)
![](https://github.com/dhf97/image/raw/main/ADJ.jpg)
![](https://github.com/dhf97/image/raw/main/GVUP.jpg)

3.确定关键点(极值点)方向。主方向，辅方向（大于主方向的80%）。圈代表尺度大小。（方向找的是**梯度方向**）

![](https://github.com/dhf97/image/raw/main/GDRT.jpg)
![](https://github.com/dhf97/image/raw/main/TU.jpg)

4.构建关键点描述符，统计每个子区域内方向的梯度长度（高斯图旋转到主方向）。8（方向）*16（子区域）= 128
![](https://github.com/dhf97/image/raw/main/CKPDC.jpg)

### [图像梯度](https://blog.csdn.net/qq_44703886/article/details/122817463)
图像梯度是指图像某像素在x和y两个方向上的变化率（与相邻像素比较），是一个二维向量，由2个分量组成X轴的变化、Y轴的变化 。其中：

- X轴的变化是指当前像素右侧（X加1）的像素值减去当前像素左侧（X减1）的像素值。
- Y轴的变化是当前像素下方（Y加1）的像素值减去当前像素上方（Y减1）的像素值。
计算出来这2个分量，形成一个二维向量，就得到了该像素的图像梯度。取反正切arctan，可得到梯度角度。


### 算法在一定程度上可解决：

1.目标的旋转、缩放、平移

2.投影变换

3.光照影响

4.目标遮挡

5.杂物场景

### SIFT算法得出的特征值（也称为SIFT描述子）可以用于：
1. 特征匹配：对于两幅图像，可以通过比较它们的SIFT描述子来找到它们之间的相似性。可以使用基于距离的匹配方法，如欧几里得距离、汉明距离等，来计算描述子之间的相似度，从而找到匹配的关键点对。

2. 物体识别：可以使用SIFT描述子来训练分类器，以识别不同的物体类别。例如，可以在图像中提取SIFT描述子，并使用机器学习算法训练分类器，以将图像分为不同的物体类别。

3. 3D重建：在计算机视觉中，可以使用SIFT算法来匹配不同图像中的特征点，从而建立三维模型。在这种情况下，SIFT描述子可以用于识别在多个视角中共同出现的关键点，以确定它们在三维空间中的位置。



## FAST算法
见论文

### SIFT和FAST异同点：

- 目的不同：SIFT的主要目的是在不同尺度空间中提取关键点并计算其描述符，从而实现图像匹配和目标识别等任务；FAST的主要目的是快速检测图像中的角点。
- 特征不同：SIFT提取的是具有尺度不变性和旋转不变性的局部特征描述符，包括关键点的位置、尺度、方向和描述符等信息；FAST则提取的是角点特征。
- 算法不同：SIFT算法包括尺度空间极值点检测、关键点定位、关键点方向确定、关键点描述符计算等步骤；FAST算法则采用一种非常快速的检测角点的方法，通过阈值检测和非极大值抑制来获得角点。
- 计算速度不同：SIFT算法的计算速度较慢，主要是因为其使用了高斯金字塔和差分金字塔等计算机资源较为复杂的算法；FAST算法则具有较快的计算速度，适合用于实时应用。

适用场景不同：由于SIFT算法能够提取丰富的局部特征描述符，因此适用于复杂场景下的目标识别、拼接等任务；FAST算法则适用于快速检测角点的场景。

## FSIFT特征提取
采用**SIFT算法提取图像区域特征，具有尺度不变性和旋转不变性等优点，能够避免图像尺寸变化和偏差产生的影响**。但是，由于**SIFT算法**的计算和数据存储复杂度较高，**不适用于实时性较强的图像处理**。FAST算法只能对特征点进行检测，不能对其进行特征描述。

因此两者结合。通过FSIFT特征提取算法对图像特征进行提取，首先**通过FAST特征点检测算法检测特征点**，然后将以 16×16 窗口为中心的特征点每个特征点划分为16个4×4的patch，计算每个像素的梯度值，并将各patch上的梯度直方图划分为8个方向，计算每个梯度方向的累积值并形成一个种子点，最终得到128维向量作为特征点的描述向量。

### 补充一些其他的算法：
- SURF（Speeded Up Robust Features）：一种加速版的SIFT算法，通过使用快速的Haar小波变换代替DoG算子来加速特征点检测，并使用积分图像计算图像特征描述符。
- ORB（Oriented FAST and Rotated BRIEF）：结合了FAST角点检测和BRIEF描述符的算法，通过在FAST检测器中引入方向和使用旋转BRIEF描述符来提高匹配性能。
- BRISK（Binary Robust Invariant Scalable Keypoints）：一种加速版的ORB算法，使用更大的特征描述符，并引入分布式采样和方向性采样以提高特征点的稳定性和抗噪性。
- AKAZE（Accelerated-KAZE）：一种加速版的KAZE（特征尺度空间加速的Zernike矩）算法，使用加速的图像金字塔构建和非线性尺度空间采样来提高特征检测速度和匹配性能。

## BoF模型[（简介）](https://blog.csdn.net/wydbyxr/article/details/82384414)
1. [Bag of Features (BOF)图像检索算法及其python实现（附代码）](https://blog.csdn.net/weixin_43842653/article/details/90145486)
2. [BOF——Bag-of-Featrures](https://blog.csdn.net/hong__fang/article/details/50550867)


指的是用一组无序的有代表性的**特征单词**来**表示视觉内容**，并使用给定图像中**单词出现的频率来表达图像**。

采用FSIFT算法提取的缺陷特征包含大量的冗余特征，不能直接将其应用于瓷砖表面缺陷的分类。因此，构建 BoF模型**将冗余特征通过计算词频向量的方式来实现瓷砖的缺陷分类**

**（重要）**对特征个数进行归一化处理，统计词典中每个单词出现的频率形成视觉单词直方图，避免了因提取特征数不同而造成的分类不准的问题。

### [K-means](https://zhuanlan.zhihu.com/p/184686598)
K-means算法将特征向量聚类形成视觉词典，具体步骤如下：

1. 选择**聚类中心的数量k**，k代表聚类中心的个数。
2. **随机选取k个特征向量作为聚类中心**，这k个向量即为视觉词典中的单词。
3. **对于每个特征向量，计算它与k个聚类中心的距离，并将它划分到距离最近的聚类中心对应的簇中。**
4. 对于每个**簇**（具有相似特征的数据点的集合，这些数据点被分配到同一个聚类中心），重新计算该簇内所有特征向量的平均值，并将这个平均值作为新的聚类中心。
5. 重复步骤3和步骤4，直到聚类中心不再变化或达到预设的迭代次数。

在这个过程中，**特征向量**被转化成了与聚类中心的**距离**，通过不断的迭代，聚类中心的位置不断地调整，最终形成了**视觉词典**，即所有聚类中心的集合。这些聚类中心就代表了不同的视觉单词，每个特征向量被映射到离它最近的聚类中心对应的视觉单词。这样，每个图像就被转化为一个视觉单词的频率向量，称为词袋（Bag-of-Words）。这种方式可以将图像的局部特征表示为全局特征，进而进行分类和检索等任务。

## 彩色瓷砖图像特征提取

本文利用颜色矩特征来描述彩色瓷砖图像的缺陷区域，作为一种简单有效的颜色特征提取方法，颜色矩特征避免了对瓷砖表面颜色进行量化处理，同时又降低了瓷砖颜色特征的维数，明显优于其他颜色特征表示方法。

### 量化处理
对瓷砖表面颜色进行量化处理，指的是将彩色图像中的像素颜色信息转换成一组数字，以方便计算机对其进行处理。

利用颜色矩特征对彩色瓷砖图像的颜色特征进行描述时，图像中的所有颜色分布都可以用它的矩来表示，由于颜色分布信息主要集中在低阶矩中，因此采用颜色的一阶矩（均值）、二阶矩（方差）以及三阶矩
（偏移性）就足以表现出彩色瓷砖表面的颜色分布。

### 颜色矩
颜色矩是一种用于描述图像颜色分布的统计特征。它可以通过对图像像素的颜色值进行数学运算得到。常见的颜色矩有一阶矩（均值）、二阶矩（方差）、三阶矩（偏移性）、四阶矩（峭度）等。

- 一阶矩（**均值**）描述的是图像颜色的平均值，反映了**图像的亮度或色调**；
- 二阶矩（**方差**）描述的是图像颜色的分散程度，反映了图像的颜色纯度或**饱和度**；
- 三阶矩（**偏移性**）描述的是图像颜色分布的偏斜程度，反映了图像**颜色分布的对称性**；
- 四阶矩（峭度）描述的是图像颜色分布的峰度，反映了图像颜色分布的平坦度或峰态程度。

# 3、模型建立
本文提出的瓷砖表面缺陷检测算法包括两部分：

- 在**灰色瓷砖图像**上建立 BoF模型**提取图像特征**
- 另一部分则是在**彩色瓷砖图像**上利用颜色矩来**描述瓷砖的区域特征**

架构如下：

![](https://github.com/dhf97/image/raw/main/MFC.png)

以两种不同特征对瓷砖被准确分类的准确率作为权重的分配依据，若某一特征分类的准确率较高，则说明该特征对瓷砖缺陷的描述能力较强，因此对其分配较大的权重。本文采用 0和 1作为两种特征的权重系数，**准确率高的特征权重系数分配为 1，其余分配为 0。**

![](https://github.com/dhf97/image/raw/main/weight.png)

形成融合后的综合特征向量，并对其再次采用 SVM 进行分类，获取最终的瓷砖分类结果。

![](https://github.com/dhf97/image/raw/main/TZRH.png)

详细看原文

# 4、实验结果与分析

![](https://github.com/dhf97/image/raw/main/SFCP.png)

1. FSIFT 算法不仅可以提高特征检测的速度，而且相比于 SIFT 算法可以更快地获取更多的特征，使得运算变得更加快速有效，从而降低了运算的复杂度。
2. 当提取的特征个数过少时则不具备描述图像区域的能力，而过多则会导致运算速度变慢，达不到预期的效果。考虑到运行效率，选择较大的 t 和较小的k应用于实验中。特征点检测阈值 **t** (在使用关键点检测算法提取图像特征时，设定的特征点质量阈值，只有特征点的质量得分高于该阈值才会被保留)**20**,特征词典容量 **k **(在使用 K-means 聚类算法构建视觉词典时，设定的聚类中心数目，也就是视觉单词的数量)=**160**最佳。
3. 各个 patch 在不同步长情况下，针对不同样本个数的缺陷识别精度。在同一样本数下各**patch之间间距越小，则缺陷的识别精度就越高**；而如果选择的训练样本数目太少，则会导致视觉词典不完备，使得识别精度值较低。
4. **瓷砖图像的表面缺陷特征主要集中在饱和度分量和亮度分量中**，但是在工厂的实际生产过程中，瓷砖图像的采集由于受光照因素的影响，使得其对比度较低，缺陷区域和背景反差较大。因此，为降低光照因素对瓷砖分类效果的影响，本文选择去除亮度属性值，只采用色调分量和饱和度分量提取其相关颜色矩特征对缺陷瓷砖进行检测和分类处理。（**理解：受光照因素的影响，整张图像的对比度都会降低，这就会使得缺陷区域和背景之间的差异也变小**）


### 物理层面：
对瓷砖缺陷图像加入 δ=15、20、25三种不同的**高斯噪声**后，分析在该情况下，曝光率分别为40、60、80、100、120、14六种不同状态时检测到的瓷砖表面缺陷的识别率大小。由表中数据可知，在三种不同的噪声等级下，随着瓷砖表面曝光率的增加，瓷砖的平均识别率呈现出逐渐上升的趋势，当曝光率达到 **120、140 时，其平均识别率也达到了最高。**

#### 高斯噪声：
在数字信号处理中，由于采样、传输等因素的影响，信号可能会受到噪声的干扰，其中高斯噪声是一种常见的噪声类型。在**图像处理中，高斯噪声会表现为图像中的像素值存在随机波动，使图像变得模糊或失真。（模拟实际生产环境中的图像噪声）**


# 5、结论
该算法提高了瓷砖缺陷分类的准确性，对有**浅显细微缺陷的瓷砖、缺陷类型复杂的瓷砖、简单瓷砖及有光照变化的瓷砖**均能取得较好的分类效果。